<!DOCTYPE html>
<html lang = "en">
  <head>
    <meta charset = "utf-8">
    <meta http-equiv = "X-UA-Compatible" content = "IE=edge">
    <meta name = "viewport" content = "width=device-width, initial-scale=1">
    <title>lelugom's blog</title>
    <link rel="shortcut icon" href="https://images.unsplash.com/photo-1473970367503-7d7f8d1bf998?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=200&fit=max&s=80e38058ebf664487e8f1d436580abf6">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

    <style type="text/css">
      body {
        background-repeat: repeat; /*color '#a2bccc'*/
        background-size: cover;
        font-size: 1.5em;
        font-family: "Comic Sans MS", cursive, sans-serif;
        text-align: justify;
      }
      h2 {
        text-align: center !important;
        color: #5882FA !important;
      }
      h3 {
        text-align: center !important;
      }
      img {
        max-width: 100%;
        max-height: 100%;
      }
      blockquote {
        font-size: inherit;
      }
      .post {
        background-color: white;
        margin-bottom: 10px;
        border-radius: 5px;
      }
      .index {
        background-color: white;
        margin-bottom: 10px;
        border-radius: 3px;
        padding: 10px;
        overflow-y: auto;
      }
      .index h4 {
        color: #5882FA !important;
      }
      .index h5 {
        color: #5882FA !important;
      }
      #mainPane {
        margin-top: 60px;
      }
      .console {
        color: white;
        background-color: #300A24;
      }
      .hidden {
        visibility: hidden;
      }
      .twitter-follow-button {
          margin: 10px 10px 0 10px;
      }
      .timeline {
        margin: 10px 0 5px 0;
      }
      .container {
        padding: 0;
      }
    </style>
  </head>
  <body>
    <!-- Navigation bar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#index-collapse" aria-expanded="false">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href=""><span class="glyphicon glyphicon-home"></span> Home</a>
        </div>
        <div class="collapse navbar-collapse" id="index-collapse">
          <ul class="nav navbar-nav">
            <li><a id="blogBttn" href="#blog"><span class="glyphicon glyphicon-blackboard"></span> Blog</a></li>
            <li><a id="readListBttn" href="#readList"><span class="glyphicon glyphicon-book"></span> Reading List</a></li>
          </ul>
          <div class="nav navbar-nav navbar-right">
            <a class="twitter-follow-button" href="https://twitter.com/lelugom" data-size="large" data-show-count="false">Follow @lelugom</a>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main panel -->
    <div class="container" id="mainPane"></div>

    <!-- Reading list -->
    <div class="hidden index" id="readList">
      <!--<a href="" class="list-group-item">
        <h4 class="list-group-item-heading"><br/> <br/>&nbsp;</h4>
        <p class="list-group-item-text"> <br/>&nbsp;</p>
      </a>-->
      <p class="lead text-center"><br/>Interesting readings <br/>about technology, finance and self-help</p>
      <p class="lead text-center"></p><!--2017-->
      <a href="https://play.google.com/store/books/details?id=_i6bDeoCQzsC" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>Clean Code: A Handbook of Agile Software Craftsmanship<br/>&nbsp;</h4>
        <p class="list-group-item-text">A must read for anyone involved or interested in software development. Robert Martin, a renowned computer programmer and writer, teach us how to create software that is easy to maintain and extend with new features. He explains how to appropriately name variables, functions, and classes, as well as how to approach the design of functions, classes, and systems. Two chapters are dedicated to the delicate subject of concurrent programming. The author also highlights the importance of good commenting practices and the development of an excellent test suite using Test Driven Development practices. As a reinforcement of good practices, the book includes a chapter explaining the thinking process and the decisions Robert made to refactor an existing Java module according to the principles explained in the book. As maintenance is one of the biggest cost in any software project, it's instrumental to apply author's suggestions in order to generate quality code. <br/>&nbsp;</p>
      </a>
      <a href="http://openmymind.net/2011/3/28/The-Little-MongoDB-Book/" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>The Little MongoDB Book<br/>&nbsp;</h4>
        <p class="list-group-item-text">One of the most popular implementations of NoSQL systems is MongoDB, which has been increasing in usage as an alternative to relational databases on production systems. Its availability and escalation make it a feasible option for web scale applications, as this database system is part of the MEAN stack - MongoDB, Express, Angular, and NodeJS. The introduction presented by Karl Seguin in this short ebook is a recommended reading for anyone interested in knowing about this kind of database systems. SQL background is recommended, as some of the examples and ideas compare both systems in terms of functionality and components. You can download the book in EPUB or PDF format for free.<br/>&nbsp;</p>
      </a>
      <a href="http://openmymind.net/The-Little-Go-Book/" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>The Little Go Book<br/>&nbsp;</h4>
        <p class="list-group-item-text">The Go programming language was created at Google by Robert Griesemer, Rob Pike, and Ken Thompson. They started to work on the project in 2007 and then, they released it as an open source project in 2009. The language has been increasing in popularity according to the TIOBEX index, as it is designed with a focus on simplicity and concurrency. This short book is a thorough introduction aimed at programmers with previous knowledge of statically typed languages such as C or Java, who are familiar with pointers, data structures, locks, etc. There are lots of examples to help you understand the main characteristics of the language and experiment with the concepts explained. It's available for free in PDF, EPUB, or MOBI e-reader format.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=uyjf3uaQ4TwC" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>Quiet: The Power of Introverts in a World That Can't Stop Talking<br/>&nbsp;</h4>
        <p class="list-group-item-text"> I highly recommend this beautifully crafted piece of advice especially aimed at introverts. This is one of those books you wish you have read way before in your life. Susan Cain encourages you to be yourself by taking the most out of your strengths and personality traits, while at the same time, compensating for your weaknesses and uncomfortable experiences. Lots of references to psychology research and real examples question the culture of personality - which happens to be quite popular in the western hemisphere - and help you understand your different reactions to uncomfortable situations. This book gives you great tips for your day to day challenges at school, work, and home.<br/>&nbsp;</p>
      </a>
      <p class="lead text-center"><br/>-</p><!--2016-->
      <a href="https://play.google.com/store/books/details?id=oHLsAgAAQBAJ" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>Think And Grow Rich<br/>&nbsp;</h4>
        <p class="list-group-item-text">This classic work of personal development literature was published after the stock market crash of 1929. Although it was written near a century ago, it has sound advice which is still valid to face today's challenges in different aspects of your life. A practical strategy, along with real life examples, is described in the book to give you the tools to achieve what you desire in your life. Should you find yourself drifting along your journey, the principles described in the book will explain the importance of setting goals and striving to achieve them.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=qRMqB2BSJr4C" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>The Millionaire Next Door<br/>&nbsp;</h4>
        <p class="list-group-item-text">Dr. Thomas J. Stanley and Dr. William D. Danko highlight saving and living below your means as a fundamental part of your financial well-being. This book has very interesting advice to accumulate wealth based on their research and data of the affluent people in the US. Hopefully after reading this book, you will become a prodigious accumulator of wealth, as they refer to people who has accumulated considerable amounts of money throughout their life.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=N0OnBQAAQBAJ" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>A Random Walk Down Wall Street<br/>&nbsp;</h4>
        <p class="list-group-item-text">A must read for anyone interested in knowing the different financial assets and investment concepts. After some chapters of financial markets history, including booms and boosts in the capital markets, the book explains financial concepts in a very easy to read format. You don't need any financial background to understand the concepts explained by Burton Malkiel. In the last chapters, you will find advice to develop your own investment plan, set your asset allocation and improve your personal finances.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=i1y1atdmNcoC" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>Self-Promotion for Introverts. The Quiet Guide to Getting Ahead<br/>&nbsp;</h4>
        <p class="list-group-item-text">Great reading packed with real life stories and advice by many successful and famous professionals in different areas such as politics, finance and sports. The Author made an amazing job by encouraging the development of a plan at the end of each chapter, in order to apply the concepts learned while reading and increase the understanding of yourself. The book contains practical advice for different areas such as the job search process, salary negotiations and networking. Public speaking tips for excelling at your presentations are included as well. It also contains real-world examples and Author's own personal experiences while writing the book, in order to enforce the concepts laid down and encourage you to improve your professional life.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=hB25AwAAQBAJ" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>48 Days to the Work You Love<br/>&nbsp;</h4>
        <p class="list-group-item-text">Should you find yourself in the midst of a job hunting process or you feel hapless in your current job, this comprehensive guide will lay down the foundations to develop a plan for discovering what you are really passionate about, and become aware of your personality traits, strengths and weaknesses. Real life successful cases are presented in order to give you a better insight of the different concepts and help you advance your professional career. You will also define a clear goal to focus your daily job on what you find rewarding. Through a 48 day plan, you will follow a job hunting strategy that is going to hopefully land you an exciting and fulfilling job.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=YtE6JJ78XLcC" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>I Will Teach You To Be Rich<br/>&nbsp;</h4>
        <p class="list-group-item-text">A thorough guide about setting your financial life in order. It has easy to follow and practical steps for tackling debt, budgeting, saving, planning and investing. It's ideal if you have not started or you are just starting your financial journey. I strongly suggest you read this book first and apply the steps to your personal finances before even considering the idea of investing.<br/>&nbsp;</p>
      </a>
      <a href="https://play.google.com/store/books/details?id=a8LBjVImeO4C" class="list-group-item">
        <h4 class="list-group-item-heading"><br/>The Plague<br/>&nbsp;</h4>
        <p class="list-group-item-text">A novel written by Nobel prize winner Albert Camus, it's a vivid story developed in the Algerian city of Oran. The book depicts the human nature in difficult situations of life and the different reactions that people have when they face a harsh environment. Throughout the prose, you will connect to the different emotions of the situation, grow your reflection capabilities and identify the strengths of the characters. <br/>&nbsp;</p>
      </a>
    </div>

    <div class="hidden" id="finInfo"></div>

    <!-- Posts -->
    <div class = "hidden" id="hiddenPane">
      <div class="post" id="20161214">
        <h2>Distributed ledgers in the digital market</h2>
        <p>&nbsp;</p>
        <p class="intro">The blockchain technology is a distributed ledger for electronic transactions, which is used by various virtual currencies including bitcoin, the most popular virtual currency in the market. Melanie Swan, author of the  book <var>Blockchain: Blue Print for a New Economy</var>, <a href="http://www.slideshare.net/lablogga/cryptocitizen-smart-contracts-pluralistic-morality-and-blockchain-society">states</a> that "Blockchains are an important new form of information technology, a descentralized infraestructure and organizational system that is universal, global, secure and granular"</p>
        <p>&nbsp;</p><a class="col-xs-12"  href="https://www.amazon.com/Bitcoin-Blueprint-New-World-Currency/dp/1491920491"><img class="col-xs-offset-3 col-xs-6" src="https://images-na.ssl-images-amazon.com/images/I/51LigLI1fuL._SX379_BO1,204,203,200_.jpg"/></a><p>&nbsp;</p>
        <p>The main characteristic of these ledgers is that they are handled by a distributed network of participants rather than a centralized entity. The participants are called nodes and a central validation system is not needed at all because of the nodes distributed topology.  Another important consideration is the extensive use of cryptographic techniques to store the assets and validate the ledger transactions with a digitally secure approach.</p>
        <p>Even though the most popular applications for the blockchain technology are the virtual currencies, it is increasingly finding new applications for the financial and banking industry. Those applications include the electronic payment infrastructure and the digital assets for the capital markets.</p>
        <p>It is also possible to find distributed ledgers for the digital identities used by software applications, web sites and digital signatures. At the same time, distributed ledgers may be used to create verifiable registries for any data, file or business process, making these ledgers a mainstream technology in the digital market. As Blythe Masters, CEO of fintech firm Digital Asset, said <a href="http://www.coindesk.com/blythe-masters-tipping-point-blockchain-adoption-2017/">recently</a>: "We're at a tipping point where this technology is turning mainstream and this technology needs to be understood by a more mainstream audience."</p>
        <p>&nbsp;</p><a class="col-xs-12"  href="https://www.hyperledger.org/"><img class="col-xs-offset-2 col-xs-8" src="https://www.hyperledger.org/wp-content/uploads/2016/09/logo_hl_new.png"/></a><p>&nbsp;</p>
        <p><var>The Linux Foundation</var> launched the collaborative project  <var>Hyperledger</var>, an effort to advance the blockchain technology by developing an open standard for the distributed ledgers. This initiative can potentially transform the way the business transactions are performed nowadays, and redefine the rules for different industries, such as healthcare, manufacturing and supply chain.</p>

          <!--blockquote class="twitter-tweet" data-lang="en" align="center" theme="dark">
            <a href="https://twitter.com/lelugom/status/809292674872307713"></a>
          </blockquote-->
      </div>

      <div class="post" id="20161107">
        <h2>Access Twitter REST API from Perl</h2>
        <p>&nbsp;</p>
        <p class="intro">Twitter provides services to access information from the site through REST APIs. The HTTP process makes GET and POST requests in order to read or write data, and the Twitter endpoint sends responses to those requests using the JSON format. All requests should use Oauth authentication in order to identify particular users and applications accessing Twitter services.</p>

        <p>This script will show you how to use the user authentication model to access the Twitter API, which is based on the open protocol Oauth 1.0. First, go to <a href="https://apps.twitter.com/">apps.twitter.com</a> and login with your username and password. Then, click on the <var>Create New App</var> button. Name your app appropriately and fill in the requested data. Access your newly created application and click on the <var>Keys and Access Tokens</var> tab. You will need four keys from this tab

          <ul>
            <li>Consumer Key (API Key)</li>
            <li>Consumer Secret (API Secret)</li>
            <li>Access Token</li>
            <li>Access Token Secret</li>
          </ul>
        </p>

        <p>Make sure you don't share neither your <var>Consumer Secret</var> nor your <var>Access Token Secret</var> with anyone. You can download the script from <a href="https://github.com/lelugom/scripts/blob/master/perl_oauth_twitter.pl">perl_oauth.pl <span class="glyphicon glyphicon-download-alt"></span></a> and modify the keys accordingly. Let's import the modules for the script and define constants with the four keys from the <a href="https://apps.twitter.com/">apps.twitter.com</a> page. Include the base url to access the REST API as well</p>

          <pre>
  #!/usr/bin/perl
  use strict;
  use warnings;
  use URI::Escape;
  use JSON::PP;
  use Digest::MD5 qw(md5_hex);
  use Digest::SHA qw(hmac_sha1_base64);
  use Time::HiRes qw(time);

  use constant {
    CONSUMER_KEY => "Consumer key",
    SECRET_KEY   => "Consumer secret",
    OAUTH_TOKEN  => "Access token",
    SECRET_TOKEN => "Access token secret",
    TWITTER_API  => "https://api.twitter.com/1.1/statuses/",
  };
          </pre>

        <p>Declare a function with three parameters. A string for the type of request, a string for the url to be accessed and a hash for the parameters of the HTTP request. Declare local variables including a hash with OAuth parameters. The function <code>md5_hex</code> will be used for computing a unique random value for each request. This value will be stored in the variable <code>oauth_nonce</code>, its parameters are a random number concatenated to the result of the function <code>time</code> from Time::HiRes module. The HTTP data hash will be merged with the OAuth parameters for the subsequent computations</p>
        <pre>
  sub twitterOauth {
    my ($req, $url, %getData) = @_;
    my $secret_token = SECRET_TOKEN;
    my $secret_key = SECRET_KEY;
    my ($oauth_signature, $base_signature, $signing_key, $authorization, $response,
      $parameter) =  ('', '', '', '', '', '');
    my %oauth_parameters = (
      "oauth_consumer_key"     => CONSUMER_KEY,
      "oauth_nonce"            => md5_hex(int time() . int rand(~0)),
      "oauth_signature_method" => "HMAC-SHA1",
      "oauth_timestamp"        => int time(),
      "oauth_token"            => OAUTH_TOKEN,
      "oauth_version"          => "1.0",
      );

    $url = TWITTER_API . $url;
    %oauth_parameters = (%oauth_parameters, %getData);
        </pre>

        <p>The signature method <var>HMAC-SHA1</var> will be used for computing the Oauth signature, this method is provided by the function <code>hmac_sha1_base64</code> in the module Digest::SHA. First, create a string separated by &amp; characters containing all the data in the Oauth parameters hash, using the <code>key=value</code> format. Parameter keys should be sorted in alphabetical order. Then, create the base signature string by concatenating the HTTP method in uppercase with the percent encoded URL and the percent encoded string for oauth parameters, joining the strings with the &amp; character.</p>

        <p> Create the signing key by concatenating the <var>Consumer Secret</var> with the <var>Access token secret</var>, joining the strings with the &amp; character. Remember to percent encode each string before concatenation. Now, compute the oauth signature with the base signature and the signing key. It's important to know that CPAN digest modules don't pad the computed base64 signature by convention. Therefore, manually pad the computed signature with the code from the <a href="http://search.cpan.org/~mshelor/Digest-SHA-5.96/lib/Digest/SHA.pm#PADDING_OF_BASE64_DIGESTS">CPAN documentation</a> to avoid authentication errors when accessing the API</p>
        <pre>
    foreach $parameter (sort keys %oauth_parameters){
      $base_signature .= "$parameter=$oauth_parameters{$parameter}&"
    }
    chop($base_signature); #remove trailing & character

    $base_signature = uc($req) . '&' . uri_escape($url) . '&' . uri_escape($base_signature);
    $signing_key = uri_escape($secret_key) . '&' . uri_escape($secret_token);
    $oauth_signature = hmac_sha1_base64($base_signature, $signing_key);
    # Pad base64 output, CPAN Digest modules don't pad by convention
    while (length($oauth_signature) % 4) {
      $oauth_signature .= '=';
    }
        </pre>
        <p>Now we are ready to build the authorization string for the HTTP request. Use the <code>key=value</code> format and remember to percent encode each value. </p>
        <pre>
    $authorization = 'OAuth oauth_consumer_key="' . uri_escape($oauth_parameters{"oauth_consumer_key"}) .
      '", oauth_nonce="' . uri_escape($oauth_parameters{"oauth_nonce"}) .
      '", oauth_signature="' . uri_escape($oauth_signature) .
      '", oauth_signature_method="' . uri_escape($oauth_parameters{"oauth_signature_method"}) .
      '", oauth_timestamp="' . uri_escape($oauth_parameters{"oauth_timestamp"}) .
      '", oauth_token="' . uri_escape($oauth_parameters{"oauth_token"}) .
      '", oauth_version="' . uri_escape($oauth_parameters{"oauth_version"}) . '"';
        </pre>
        <p>Let's use curl to access the Twitter API, using the --header option to pass the authorization string. Then, return the JSON formatted string received from API server.</p>
        <pre>
    $parameter = join('&', map{"$_=$getData{$_}"} keys %getData);
    $parameter = "--" . lc($req) . " \'$url\' --data \'$parameter\' --header \'Authorization: $authorization\'";
    $response = curl($parameter);

    return $response;
  }

  sub curl {
    my ($curl_args) = @_;
    my $response;

    # System call for curl
    $curl_args = 'curl -k --silent -A "' .
      'Mozilla/5.0 (Windows NT x.y; Win64; x64; rv:10.0) Gecko/20100101 Firefox/10.0" ' .
      "$curl_args 2>&1";
    $response = qx{$curl_args};
    die "Unable to download webpage $curl_args " if ( $? == -1 );

    return $response;
  }
        </pre>
        <p> As an example, here is the code to download the last 12 tweets from the <a href="https://twitter.com/twitterdev">@twitterdev</a> account and print the JSON formatted string in the standard output. The <a href="https://dev.twitter.com/rest/reference/get/statuses/user_timeline"> GET statuses/user_timeline </a> HTTP request will be send. Remember to use JSON::PP module to decode the returned string for you particular needs.
        </p>
        <pre>
  print twitterOauth("GET", "user_timeline.json", (screen_name => "twitterdev", count => 12)); </pre>
      </div>

      <div class="post" id="20161205">
        <h2>Convert HP LaserJet 1000 into a network printer with OpenWrt</h2>
        <p>&nbsp;</p>
        <p class="intro">The HP LaserJet 1000 is a black and white printer which comes with a USB cable to connect directly to a port in your computer. Nevertheless, if you have a router with OpenWrt installed and a spare USB port on it, you can connect your USB printer to the router and share it in your Local Area Network to allow access from any Windows or Linux computer.</p>

        <p>To make this happen, you need both a firmware file for the printer and a printer server. The drivers for the printer send the firmware file every time the printer powers on, so the router should do the same. To get the printer firmware file, we will use <a href="http://foo2zjs.rkkda.com/">foo2zjs</a>, an open source printer driver which supports HP LJ 1000 printer. So, let's download the driver and unpack it </p>

        <pre class="console">
  $ wget -O foo2zjs.tar.gz http://foo2zjs.rkkda.com/foo2zjs.tar.gz
  $ tar zxf foo2zjs.tar.gz
  $ cd foo2zjs</pre>

        <p>Compile and install it </p>
        <pre class="console">
  $ make
  $ ./getweb 1000
  $ sudo make install</pre>

        <p>Now, under the foo2zjs folder. you will find the file <strong>sihp1000.dl</strong>, which is the firmware file that the router should send through the USB port every time the printer powers on. Store this file in your router file system under the folder <var>/etc/config</var> to preserve it whenever you update the router with the <code>sysupgrade</code> command. We will use the <a href="http://man.cx/p910nd">p910nd</a> printer server, a small non-spooling printer daemon intended for disk-less linux hosts, which copies any data received on the port it is listening on to the corresponding printer port. Let's install the printer server and the USB printing module <var>kmod-usb-printer</var></p>
        <pre class="console">
  $ opkg update
  $ opkg install kmod-usb-printer p910nd</pre>

        <p>Modify firewall configuration on <var>/etc/config/firewall</var> to accept packets on  TCP port <var>9100</var></p>
        <pre>
  # Allow attached network printer hplj1000
  config 'rule'
      option 'src' 'lan'
      option 'proto' 'tcp'
      option 'dest_port' '9100'
      option 'target' 'ACCEPT'</pre>

        <p>Check the file <var>/etc/config/p910nd</var> has the following information, assuming your router IP is <var>192.168.1.1</var></p>
        <pre>
  config p910nd
    	option device        /dev/usb/lp0
    	option port          0
    	option bidirectional 1
    	option enabled       1
    	option bind          192.168.1.1</pre>

        <p>We need a script to send the firmware file to the printer any time it powers on. So, let's create the script <code>/etc/hotplug.d/usb/hplj1000</code>. Remember that we store the firmware file <strong>sihp1000.dl</strong> under the folder <var>/etc/config</var> </p>
        <pre>
  #!/bin/sh

  FIRMWARE="/etc/config/sihp1000.dl"

  if [ "$PRODUCT" = "3f0/517/120" ]
  then
          if [ "$ACTION" = "add" -a "$DEVTYPE" = "usb_interface" ]
          then
                  logger "Sending firmware to HP LJ1000 printer..."
                  cat $FIRMWARE > /dev/usb/lp0
                  logger "done."
          fi
  fi</pre>

        <p>Start and enable the printer daemon</p>
        <pre class="console">
  $ /etc/init.d/p910nd start
  $ /etc/init.d/p910nd enable</pre>

        <p>At this point, the printer daemon is up and running. The next step is to install the printer on the computer. Depending on the OS on your computer, follow the instructions <a href="https://wiki.openwrt.org/doc/howto/p910nd.server#configuration_part_2_the_clients">here</a>, and use your router IP address and the port <var>9100</var>. For instance, if you have Ubuntu installed in your computer, go to printers and click the + button to add a printer and type <var>192.168.1.1:9100</var> in the network address input field, assuming that's your router IP. A JetDirect printer will appear, select it and then choose the HP foo2zjs driver previously installed, see the two images bellow</p>
        <img class="col-xs-12" src="hplj1000_0.png"/><p>&nbsp;</p><img class="col-xs-12" src="hplj1000_1.png"/><p>&nbsp;</p>

        <p>Finally, if you need to spool jobs, there is an easy workaround. After installing the network printer on your computer, go to <a href="https://www.google.com/cloudprint">Google cloud print</a> and add the printer using the <var>Add a Classic Printer</var> option. Then, share this printer to the users you need. This way, any person with the shared printer can send print jobs, and they will be sent to the printer whenever chrome runs on your computer. Remember to synchronize chrome to your Google account for the spooling to work.</p>

        <!--blockquote class="twitter-tweet" data-lang="en" align="center" theme="dark">
          <a href="https://twitter.com/lelugom/status/805813783713169409"></a>
        </blockquote-->
      </div>

      <div class="post" id="20161226">
        <h2>Upgrade an OpenWrt router using development snapshots</h2>
        <p>&nbsp;</p>
        <p class="intro">OpenWrt is a great distribution aimed to install a small Linux version in your embedded system, particularly your router. It supports lots of routers nowadays and new models are constantly added to the code base. There are two versions available for your router, the stable <a href="https://downloads.openwrt.org/chaos_calmer/15.05.1/">release</a>, which was updated on March 2016 and received the name Chaos Calmer 15.05.1. The other available version is the development branch, known as Designated Driver. </p>

        <p>Although you can build the development branch from the GitHub repository, there are pre-built snapshots available <a href="http://downloads.openwrt.org/snapshots/trunk/">here</a>. They does not have any web interface, therefore, all the installation process is performed from the command line interface. To showcase the process, let's update a TP-Link WDR3500  router using the build snapshot. Make sure you check the <a href="https://downloads.openwrt.org/snapshots/trunk/">snapshots page</a> to find a suitable image for your particular router! If you install the wrong image, <span class="label label-danger">you will brick your router <span class='glyphicon glyphicon-alert'></span></span>. Before starting, let's make a configuration backup in case some unexpected result happens during the update process</p>

        <pre class="console">
  $ sysupgrade --create-backup /tmp/backup_conf.tar.gz </pre>

        <p>Now, copy your backup from <var>/tmp</var> to your computer using <code>scp</code> command. Usually the storage on a router is quite limited. Therefore, we will check if the RAM available is enough to store the snapshot image in the <var>/tmp</var> filesystem</p>

          <pre class="console">
  $ free
               total       used       free     shared    buffers     cached
  Mem:        125196      26496      98700         88       1944       5748
  -/+ buffers/cache:      18804     106392
  Swap:            0          0          0 </pre>
          <p>The size of the snapshot image is usually around 3.2MB for this particular router, so we have more than enough space. Let's change working directory to <var>/tmp</var>, download the snapshot image and the checksum file to check image integrity </p>

          <pre class="console">
  $ cd /tmp
  $ wget http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/md5sums
  $ wget http://downloads.openwrt.org/snapshots/trunk/ar71xx/generic/openwrt-ar71xx-generic-tl-wdr3500-v1-squashfs-sysupgrade.bin</pre>
          <p>Now check image integrity with de <code>md5sum</code> command. If you don't get any output after running the command, the image file is corrupt. Download the image again and check it before any further step in order to avoid bricking your router</p>

          <pre class="console">
  $ md5sum -c md5sums 2> /dev/null | grep OK
  openwrt-ar71xx-generic-tl-wdr3500-v1-squashfs-sysupgrade.bin: OK</pre>

          <p>By now, We have the snapshot in our temporary storage. We are almost ready to upgrade the router, but we should first store important system files to avoid configuring the router from scratch after upgrading. In order to preserve the configuration files after performing the upgrade, you can edit the file <var>/etc/sysupgrade.conf</var> to specify wich files and directories you want to keep. This way you will preserve users, passwords, SSIDs and other configurations. Here is an example file</p>

          <pre>
  ## This file contains files and directories that should
  ## be preserved during an upgrade.

  # /etc/example.conf
  # /etc/openvpn/
  /etc/sysupgrade.conf
  /etc/sysctl.conf
  /etc/rc.local
  /etc/profile
  /etc/passwd
  /etc/firewall.user
  /etc/config
  /etc/hotplug.d/usb</pre>

          <p>Now, upgrade your router by running the <code>sysupgrade</code> command tool. It will install the new image and reboot your router.</p>
          <pre class="console">
  $ sysupgrade -v /tmp/openwrt-ar71xx-generic-tl-wdr3500-v1-squashfs-sysupgrade.bin</pre>

          <p>Finally, install the packages you regularly use in your router, such as the packages needed for a <a href="#20161205">printer server</a>, or monitoring tools such as iftop, bmon and htop

          <pre class="console">
  $ opkg update
  $ opkg install p910nd kmod-usb-printer iftop htop bmon </pre>

          <p>All the steps are compiled into a shell script in order to automate the updating process. The script is available for download at <a href="https://github.com/lelugom/scripts/blob/master/tplwdr3500_upgrade.sh">tplwdr3500_upgrade.sh <span class="glyphicon glyphicon-download-alt"></span></a>. Store the file in a router directory included in the file <var>/etc/sysupgrade.conf</var>, such as <var>/etc/config</var>, to preserve it after upgrade. Thus, any time you want to upgrade, you will want to run the following command</p>
          <pre class="console">
  $ sh /etc/config/tplwdr3500_upgrade.sh </pre>

      </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript" src="fin.js"></script></body>
    <script type="text/javascript">
      'use strict';
      var backgroundImage =
       'url("https://images.unsplash.com/photo-1435777940218-be0b632d06db?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;s=18cb0153c5365100ee6b46d1180c5f1d")';
      var gridClass = "col-xs-12 col-md-offset-2 col-md-8";
      var postClass = "col-xs-12 col-md-offset-2 col-md-8";
      var listClass = "col-xs-12 col-md-offset-2 col-md-8";

      // Load twitter JS to avoid script tags in the HTML elements
      window.twttr = (function(d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0],
          t = window.twttr || {};
        if (d.getElementById(id)) return t;
        js = d.createElement(s);
        js.id = id;
        js.src = "https://platform.twitter.com/widgets.js";
        fjs.parentNode.insertBefore(js, fjs);

        t._e = [];
        t.ready = function(f) {
          t._e.push(f);
        };
        return t;
      }(document, "script", "twitter-wjs"));

      // Set some document elements
      $(".post").addClass(postClass);
      $(".post").each(function() {
        $(this).find('a').each(function(){
          $(this).attr("target", "_blank");
        });
      });
      $("#readList").addClass(gridClass);
      $("#readList").find('a').each(function(){
        $(this).attr("target", "_blank");
      });
      createIndex();

      // Events
      $(document).on("click", ".entry", function(event){
        // click function does not work cause <a> elements were
        // created after loading DOM. So, use on function
        event.preventDefault();
        // Update URL
        window.location.replace($(this).attr('href'));
        loadPost(this);
      });
      $("#blogBttn").click(function(event){
        event.preventDefault();
        window.location.replace($(this).attr('href'));
        $(".navbar-collapse").collapse('hide');
        createIndex();
      });
      $("#readListBttn").click(function(event){
        event.preventDefault();
        window.location.replace($(this).attr('href'));
        $(".navbar-collapse").collapse('hide');
        setMainPane($("#readList").clone().removeClass("hidden"));
      });
      // References in URL
      var reference = /\#\w+$/.exec(window.location.href);
      if(reference && reference.length){
        if(reference[0] === '#readList'){
          setMainPane($(reference[0]).clone().removeClass("hidden"));
        } else if(reference[0] === '#finInfo'){
          setMainPane($(reference[0]).clone().removeClass("hidden"));
          $("body").css("background-image", '');
          $("body").css("background-color", '#a2bccc');
        } else if($(reference[0]).length){
          // link should be a blog post reference
          loadPost(reference[0]);
        }
      } else {
        // Main page
        createTimeline();
      }

      // Create posts index in main panel and post list for blog posts
      function createIndex(){
        var index = document.createElement('div');
        var list = document.createElement('div');

        $(index).addClass(gridClass + ' index');
        $(index).attr('id', 'postsIndex');
        $(list).addClass(listClass + ' index');
        $(list).attr('id', 'postsList');
        $(list).append($(document.createElement('p'))
          .addClass('lead text-center').html('Recent posts'));
        $("#mainPane").empty();

        $(".post").each(function() {
          // Assemble entry
          var entry, entryTitle, entryIntro;

          entry = document.createElement('a');
          $(entry).addClass("entry list-group-item");
          $(entry).attr('href', '#' + $(this).attr('id'));
          $(entry).attr('id', 'entry_' + $(this).attr('id'));

          entryTitle = document.createElement('h4');
          $(entryTitle).addClass('list-group-item-heading');
          $(entryTitle).html($(this).children('h2')[0].innerHTML);

          entryIntro = document.createElement('p');
          $(entryIntro).addClass('list-group-item-text');
          $(entryIntro).html('<br/>' + $(this).children('.intro')[0].innerHTML +
            '<br/><br/><small>Read more ...</small>');

          $(entry).append(entryTitle);
          $(list).append(
            $(entry).clone().attr('id', 'list_' + $(this).attr('id')));

          $(entry).append(entryIntro);
          $(index).append(entry);
        });
        setMainPane(index);
        $("#hiddenPane").append($(list));
      }

      // Create twitter timeline in main Pane
      function createTimeline(){
        var timeline = document.createElement('div');
        // add both xs and md to avoid overlapping
        $(timeline).addClass("col-xs-12 col-md-4");
        $(timeline).css("padding", "0 4px 0 4px");

        $("#mainPane").find("#postsIndex").each(function(){
          $(this).removeClass("col-md-offset-2");
          $(timeline).html(
            // Firefox does not work when using css(padding)
            // cause shorthand CSS properties are not guaranteed in jquery
            '<a class="twitter-timeline" href="https://twitter.com/lelugom" data-height="'
            + ($(this).height() + 2 * parseInt($(this).css("padding-bottom"))) +
            '"  data-show-replies="false" data-theme="dark">Tweets by @lelugom</a>');
        });

        $("#mainPane").append(timeline);
        $("body").css("background-size", "auto");
      }

      // Add selected post to main panel
      function loadPost(entry){
        var index = $(entry).attr('id').match(/\d+/g)[0];
        if(index){
          setMainPane($('#' + index).clone());
          $("#mainPane").append($("#postsList").clone());
        }
      }

      // Clear main panel content and append argument
      function setMainPane(element){
        $("#mainPane").empty();
        $("#mainPane").append(element);
        // Update background image
        $("body").css("background-image", backgroundImage);
        $("body").css("background-size", "cover");
        $("html, body").animate({ scrollTop: 0 }, "slow");

        setHeight($("#postsIndex"));
        setHeight($("#readList"));
      }

      // Set height of the element according to viewport height
      function setHeight(element){
        var paneHeight = $(window).height()
          - parseInt($("#mainPane").css("margin-top"));
        var height = paneHeight -
          parseInt(element.css("margin-bottom"))
          - 2 * parseInt(element.css("padding-bottom"));
        element.height(height);
      }
    </script>
  </body>
</html>
